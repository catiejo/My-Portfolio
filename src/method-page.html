<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="theme.html">

<dom-module id="method-page">
  <template>
    <style is="custom-style">
      :host {
        --header-background: url('');
        --header-color: white; /* Placeholder. This value is set in the Polymer script below. */
      }
      .bottom-text {
        -webkit-transform: translateZ(0);
        font-size: 20px;
        padding-bottom: 10px;
        transform: translateZ(0);
      }
      .content {
        padding: 16px 10px 16px 50px;
      }
      h1 {
        color: var(--gkl-gray-5);
        font-family: 'futura-pt', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 27px;
        font-weight: 700;
        text-align: left;
      }
      .indent {
        margin-left: 60px;
      }
      .markdown-html {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 15px;
        color: var(--gkl-gray-5);
        line-height: 125%;
      }
      .method-label {
        color: var(--gkl-gray-5);
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 14px;
        padding-top: 4px;
      }
      .method-name {
        font-family: 'futura-pt', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 20px;
        color: var(--gkl-gray-5);
      }
      paper-scroll-header-panel {
        --paper-scroll-header-panel-condensed-header: {
          background-color: var(--header-color);
        };
        --paper-scroll-header-panel-full-header: {
          background-repeat: no-repeat !important;
          background-position: center !important;
          background-image: var(--header-background);
        };
        background-color: var(--background-color);
        bottom: 0;
        left: 0;
        position: absolute;
        right: 0;
        top: 0;
      }
      paper-toolbar {
        background-color: transparent;
        height: 165px; /* Full toolbar height (condensed is specified in the element tag) */
        overflow: visible;
      }
      .spacer {
        @apply(--layout-flex);
      }
      .exemplar {
        height: auto;
        width: 90%;
      }
    </style>
    <paper-scroll-header-panel class="header" condenses condensed-header-height="75" keep-condensed-header>
      <paper-toolbar id="toolbar">
        <!-- Top of toolbar (scrolls with condensed header, too) -->
        <paper-icon-button style="color: black" on-click='goBack' icon="arrow-back"></paper-icon-button>
        <div class="spacer"></div>
        <paper-icon-button on-click='openSlides' src="{{slidesIcon}}" disabled$="{{hasNoSlides}}"></paper-icon-button>
        <!-- Method name -->
        <!-- 'bottom' class is Polymer-specific for bottom of full header -->
        <div class="bottom indent bottom-text" self-end>
          <div class="method-label">Method:</div>
          <div class="method-name">[[method.name]]</div>
        </div>
      </paper-toolbar>
      <div class="content">
        <!-- Query the database for specified method -->
        <firebase-document
          id="query"
          app-name="methods"
          path="/methods/{{methodId}}"
          data="{{method}}">
        </firebase-document>
        <!-- Method Content -->
        <h1>Exemplar</h1>
        <img class="exemplar" src="https://[[method.exemplar]]" >
        <h1>What is it</h1>
        <marked-element markdown="[[method.what]]">
          <div class="markdown-html"></div>
        </marked-element>
        <h1>Why we do it</h1>
        <marked-element markdown="[[method.why]]">
          <div class="markdown-html"></div>
        </marked-element>
        <h1>How we do it</h1>
        <marked-element markdown="[[method.how]]">
          <div class="markdown-html"></div>
        </marked-element>
        <h1>Why it works</h1>
        <marked-element markdown="[[method.whyItWorks]]">
          <div class="markdown-html"></div>
        </marked-element>
        <h1>Best practices</h1>
        <marked-element markdown="[[method.bestPractices]]">
          <div class="markdown-html"></div>
        </marked-element>
      </div>
    </paper-scroll-header-panel>
  </template>
  <script>
    Polymer({
      is: 'method-page',
      properties: {
        hasNoSlides: {
          type: Boolean,
          value: true,
        },
        method: {
          type: Object,
        },
        methodId: {
          type: String,
          value: "zombies", //Safety default value
        },
        slidesIcon: {
          type: String,
          value: "../assets/keynote-disabled.png",
        },
      },
      observers: ['methodChanged(method.length)'], //Listen for when new methods are loaded
      editMethod: function () {
        this.fire('edit-method', {action: 'edit'});
      },
      goBack: function () {
        this.fire('go-back');
      },
      methodChanged: function (changes) {
        this.setHeader();
        if (this.method.slideDeck === 'analog') {
          this.slidesIcon = "../assets/keynote-disabled.png";
          this.hasNoSlides = true;
        } else {
          this.slidesIcon = "../assets/keynote.png";
          this.hasNoSlides = false;
        }
        if (typeof this.method.inProduction !== 'undefined' && !this.method.inProduction && !this.$.edit) {
          var button = document.createElement('paper-icon-button');
          button.id = "edit";
          button.icon = 'create';
          button.style.color = '#22262A';
          button.addEventListener('click', this.editMethod);
          Polymer.dom(this.$.toolbar).insertBefore(button, Polymer.dom(this.root).querySelector('.bottom'));
        }
      },
      openSlides: function () {
        window.open('http://' + this.method.slideDeck);
      },
      setHeader: function () {
        if (this.method.inProduction) {
          this.customStyle['--header-background'] = 'url("../assets/prod-card-front-background.png")';
          this.customStyle['--header-color'] = 'var(--gkl-opaque-green)';
        } else if (typeof this.method.inProduction !== 'undefined') {
          console.log("--updating the style")
          this.customStyle['--header-background'] = 'url("../assets/sandbox-card-front-background.png")';
          this.customStyle['--header-color'] = 'var(--gkl-opaque-orange)';
        }
        this.updateStyles();
      },
    });
  </script>
</dom-module>