<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="theme.html">

<dom-module id="method-card">
  <template>
    <style>
      :host {
        display: inline-block;
      }
      :host ::content div {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 15px;
        color: var(--gkl-gray-5);
      }
      :host * {
        z-index: 0;
      }
      .back, .front { /* FIXME/HACK: this needs to be listed before the .back class for some reason */
        -moz-backface-visibility: hidden;
        -o-backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        background-color: white;
        border-radius: 25px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
        cursor: pointer;
        display: block;
        height: 100%;
        position: absolute;
        text-align: left;
        width: 100%;
      }
      .back {
        -moz-transform: rotateY( 180deg );
        -o-transform: rotateY( 180deg );
        -webkit-transform: rotateY( 180deg );
        @apply(--layout-vertical);
        transform: rotateY( 180deg );
      }
      .card {
        -moz-transform-style: preserve-3d;
        -moz-transition: -moz-transform 1s;
        -o-transform-style: preserve-3d;
        -o-transition: -o-transform 1s;
        -webkit-transform-origin: 50% 50%;
        -webkit-transform-style: preserve-3d;
        -webkit-transition: -webkit-transform 1s;
        height: 100%;
        position: absolute;
        transform-style: preserve-3d;
        transition: transform 1s;
        width: 100%;
      }
      .card.flipped {
        -moz-transform: rotateY( 180deg );
        -o-transform: rotateY( 180deg );
        -webkit-transform: rotateY( 180deg );
        transform: rotateY( 180deg );
      }
      .card-back-content {
        @apply(--layout-flex);
        background-color: white;
        overflow-y: scroll;
        padding: 15px;
      }
      .card-back-footer {
        border-bottom-left-radius: 25px;
        border-bottom-right-radius: 25px;
        height: 50px;
        padding-right: 20px; /* Offset buttons from card's edge */
      }
      .card-back-header {
        border-top-left-radius: 25px;
        border-top-right-radius: 25px;
        height: 85px;
      }
      .card-back-header p {
        color: var(--gkl-gray-5);
        font-family: 'futura-pt', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 18px;
        font-weight: 700;
        left: 20px;
        position: absolute;
        right: 20px;
        text-align: left;
        top: 8px;
      }
      .card-container {
        -moz-perspective: 800px;
        -o-perspective: 800px;
        -webkit-perspective: 800px;
        height: 465px;
        perspective: 800px;
        position: relative;
        width: 279px;
      }
      .card-front-logo {
        background-size: auto 275px;
        border-top-left-radius: 25px;
        border-top-right-radius: 25px;
        height: 275px;
        position: absolute;
        width: 100%;
      }
      .card-front-logo img {
        bottom: 0;
        left: 0;
        margin: auto;
        max-height: 200px;
        max-width: 200px;
        position: absolute;
        right: 0;
        top: 0;
      }
      .card-front-name {
        color: var(--gkl-gray-5);
        font-family: 'futura-pt', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 27px;
        font-weight: 700;
        left: 27px;
        position: absolute;
        right: 20px;
        text-align: left;
        top: 305px;
      }
      .production-theme-back {
        background-color: var(--gkl-light-green);
      }
      .production-theme-front {
        background-image: url(../assets/prod-card-front-background.png);
      }
      .sandbox-theme-back {
        background-color: var(--gkl-orange);
      }
      .sandbox-theme-front {
        background-image: url(../assets/sandbox-card-front-background.png);
      }
      #info-btn-container, #slide-btn-container {
        display: inline-block;
        float: right;
      }
      paper-icon-button {
        top: 5px;
      }
    </style>
    <div class="card-container">
      <div class="card" on-click="flipCard">
        <div class="front">
          <div class="card-front-logo">
            <img src="https://{{logo}}">
          </div>
          <div class="card-front-name">{{name}}</div>
        </div>
        <div class="back">
          <div class="card-back-header">
            <p>{{name}}</p>
          </div>
          <div class="card-back-content">
            <content class="card-back-content"></content>
          </div>
          <div class="card-back-footer">
            <div id="slide-btn-container"><paper-icon-button slide-deck="{{slides}}" on-click="openSlides" src="{{slidesIcon}}" disabled$="{{hasNoSlides}}"></paper-icon-button></div>
            <div id="info-btn-container"><paper-icon-button on-click="openMethod" src="{{infoIcon}}"></paper-icon-button></div>
            <paper-tooltip for="slide-btn-container" offset="0">{{slidesTooltip}}</paper-tooltip>
            <paper-tooltip for="info-btn-container" offset="0">Click to view more information!</paper-tooltip>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'method-card',
      properties: {
        hasNoSlides: {
          type: Boolean,
          value: true,
        },
        infoIcon: {
          type: String,
          value: "../assets/info.png", //this is concerning...why can't I use the relative path here? is this a hack?
        },
        inProduction: {
          type: Boolean,
        },
        logo: {
          type: String,
        },
        methodId: {
          type: String,
          value: 'chapters'
        },
        name: {
          type: String,
          value: 'A Method By Any Other Name...',
        },
        slides: {
          type: String,
          value: 'analog',
        },
        slidesIcon: {
          type: String,
          value: "../assets/keynote-disabled.png", //this is concerning...why can't I use the relative path here? is this a hack?
        },
        slidesTooltip: {
          type: String,
          value: "Analog method. No deck needed!"
        },
      },
      flipCard: function (e) {
        var card = Polymer.dom(this.root).querySelector('.card');
        card.classList.toggle('flipped');
      },
      openMethod: function (e) {
        e.stopPropagation();
        this.fire('method-clicked', {name: this.methodId});
      },
      openSlides: function (e) {
        e.stopPropagation();
        window.open(this.slides);
      },
      ready: function () {
        if (this.slides !== 'analog') {
          this.hasNoSlides = false;
          this.slidesIcon = "../assets/keynote.png";
          this.slidesTooltip = "Click to download the deck!";
        }
        var front = Polymer.dom(this.root).querySelector('.card-front-logo');
        var backHeader = Polymer.dom(this.root).querySelector('.card-back-header');
        var backFooter = Polymer.dom(this.root).querySelector('.card-back-footer');
        if (this.inProduction) {
          front.classList.add('production-theme-front');
          backHeader.classList.add('production-theme-back');
          backFooter.classList.add('production-theme-back');
        } else if (!this.inProduction) {
          front.classList.add('sandbox-theme-front');
          backHeader.classList.add('sandbox-theme-back');
          backFooter.classList.add('sandbox-theme-back');
        }
      },
    });
  </script>
</dom-module>
