<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="method-card.html">
<link rel="import" href="theme.html">

<dom-module id="methods-app">
  <template>
    <style>
      :host {
        background-color: var(--background-color);
        display: inline-block;
      }
      .card-container {
        display: inline-block;
        height: 100%;
        max-width: 90%;
      }
      .content {
        padding-top: 70px;
        text-align: center;
      }
      method-card {
        padding-bottom: 15px;
        padding-left: 10px;
        padding-right: 10px;
        padding-top: 50px;
      }
      .method-filters {
        background-color: var(--gkl-opaque-gray-5);
      }
      .page-header {
        background-color: var(--background-color);
        height: 100px;
        overflow: visible;
      }
      .page-title {
        color: white;
        font-family: 'futura-pt', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 48px;
        font-weight: 600;
        left: 50%;
        padding-top: 50px;
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
      }
      paper-fab {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 10;
        --paper-fab-background: var(--gkl-blue);
        --paper-fab-keyboard-focus-background: var(--gkl-blue);
      }
      paper-icon-button.logo {
        cursor: default;
        height: auto;
        top: 22px;
        width: 130px;
      }
      paper-scroll-header-panel {
        height: 100%;
      }
      paper-tabs {
        --paper-tabs-selection-bar-color: var(--gkl-blue);
        --paper-tabs-selection-bar: { height: 4px; };
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 18px;
      }
      paper-toggle-button {
        --paper-toggle-button-checked-bar: {
          background-color: var(--gkl-orange);
          opacity: 1.0;
        };
        --paper-toggle-button-checked-button: {
          background-color: white;
        };
        --paper-toggle-button-unchecked-bar: {
          background-color: var(--gkl-green);
          opacity: 1.0;
        };
        --paper-toggle-button-unchecked-button: {
          background-color: white;
        };
        padding-left: 10px;
        padding-right: 10px;
        position: relative;
        top: 25px;
      }
      .toggle-label {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        position: relative;
        top: 25px;
      }
      .spacer {
        @apply(--layout-flex);
      }
    </style>
    <paper-scroll-header-panel>
      <paper-toolbar class="page-header">
        <!-- <paper-icon-button noink class="logo" src="/assets/GKL.png"></paper-icon-button> -->
        <div class="spacer"></div>
        <div class="page-title">METHODS</div>
        <div class="spacer"></div>
        <!-- Sandbox/Production Toggle -->
        <!-- <div class="toggle-label">Production</div>
        <paper-toggle-button checked="{{toggleSelected}}"></paper-toggle-button>
        <div class="toggle-label">Sandbox</div> -->
      </paper-toolbar>
      <paper-toolbar class="method-filters">
        <div class="spacer"></div>
        <paper-tabs selected="{{tabSelected}}" noink>
          <paper-tab>Get Smart</paper-tab>
          <paper-tab>Collaborate to Solve</paper-tab>
          <paper-tab>Sprint to Make</paper-tab>
          <paper-tab>All</paper-tab>
        </paper-tabs>
        <div class="spacer"></div>
      </paper-toolbar>
      <!-- Query the Database (methods are saved to 'cards' variable in Polymer) -->
      <firebase-query
        id="query"
        app-name="methods"
        path="/methods"
        data="{{cards}}">
      </firebase-query>
      <!-- paper-scroll-header-panel content -->
      <div class="content">
        <!-- Sandbox/Production Page Controller -->
        <neon-animated-pages selected="[[toggleSelected]]" entry-animation="[[screenEntryAnimation]]" exit-animation="[[screenExitAnimation]]">
          <neon-animatable>
            <div class="card-container">
              <!-- Production Methods -->
              <template is="dom-repeat" items="{{cards}}" filter="{{prodFilter(tabSelected)}}" sort="alphabetized">
                  <method-card method-id="{{item.id}}" in-production="{{item.inProduction}}" logo="{{item.logo}}" name="{{item.name}}" slides="{{item.slideDeck}}"><marked-element markdown="[[item.whyItWorks]]"><div class="markdown-html"></div></marked-element></method-card>
              </template>
            </div>
          </neon-animatable>
          <neon-animatable>
            <div class="card-container">
              <paper-fab on-click="addMethod" icon="add"></paper-fab>
              <!-- Sandbox Methods -->
              <template is="dom-repeat" items="{{cards}}" filter="{{sandboxFilter(tabSelected)}}" sort="alphabetized">
                  <method-card method-id="{{item.id}}" in-production="{{item.inProduction}}" logo="{{item.logo}}" name="{{item.name}}" slides="{{item.slideDeck}}"><marked-element markdown="[[item.whyItWorks]]"><div class="markdown-html"></div></marked-element></method-card>
              </template>
            </div>
          </neon-animatable>
        </neon-animated-pages>
      </div>
      <!-- End content -->
    </paper-scroll-header-panel>
  </template>
  <script>
    Polymer({
      is: 'methods-app',
      properties: {
        // Object to store data from firebase
        cards: {
          type: Object,
        },
        screenEntryAnimation: String,
        screenExitAnimation: String,
        tabSelected: {
          type: Number,
          value: 3, // All
        },
        toggleSelected: {
          type: Boolean,
          value: false, // Production
          observer: 'animator',
        },
      },
      alphabetized: function (firstItem, secondItem) {
        if (firstItem.name.toLowerCase() < secondItem.name.toLowerCase()) return -1;
        if (firstItem.name.toLowerCase() > secondItem.name.toLowerCase()) return 1;
        return 0;
      },
      animator: function () {
        if (this.toggleSelected) {
            this.screenEntryAnimation = 'slide-from-left-animation';
            this.screenExitAnimation = 'slide-right-animation';
          } else {
            this.screenEntryAnimation = 'slide-from-right-animation';
            this.screenExitAnimation = 'slide-left-animation';
          }
      },
      addMethod: function (e) {
        e.stopPropagation();
        this.fire('add-method', {action: 'add'});
      },
      //FIXME: prod and sandbox filters are practically the same...consolidate them into one function
      prodFilter: function () {
        if (this.tabSelected == 0) {
          return function (item) { return (item.stage.indexOf('smart') !== -1) && item.inProduction; }
        }
        else if (this.tabSelected == 1) {
          return function (item) { return (item.stage.indexOf('collab') !== -1) && item.inProduction; }
        }
        else if (this.tabSelected == 2) {
          return function (item) { return (item.stage.indexOf('sprint') !== -1) && item.inProduction; }
        }
        else if (this.tabSelected == 3) {
          return function (item) { return ((item.stage.indexOf('smart') != -1) || (item.stage.indexOf('collab') !== -1) || (item.stage.indexOf('sprint') !== -1)) && item.inProduction; }
        }
      },
      sandboxFilter: function () {
        if (this.tabSelected == 0) {
          return function (item) { return (item.stage.indexOf('smart') !== -1) && !item.inProduction; }
        }
        else if (this.tabSelected == 1) {
          return function (item) { return (item.stage.indexOf('collab') !== -1) && !item.inProduction; }
        }
        else if (this.tabSelected == 2) {
          return function (item) { return (item.stage.indexOf('sprint') !== -1) && !item.inProduction; }
        }
        else if (this.tabSelected == 3) {
          return function (item) { return ((item.stage.indexOf('smart') != -1) || (item.stage.indexOf('collab') !== -1) || (item.stage.indexOf('sprint') !== -1)) && !item.inProduction; }
        }
      },
    });
  </script>
</dom-module>
